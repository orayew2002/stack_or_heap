# üß† Stack vs Heap Allocation in Go (Escape Analysis)

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ **escape analysis** –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Go-–∫–æ–¥–∞. –ú—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

- `escape()` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Ö–æ–¥–∏—Ç –≤ **heap**
- `noEscape()` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Å—Ç–∞—ë—Ç—Å—è –≤ **stack**

## üî¨ –¶–µ–ª—å

–ü–æ–Ω—è—Ç—å:
- –ü–æ—á–µ–º—É escape –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∞–ª–ª–æ–∫–∞—Ü–∏—è–º –≤ –∫—É—á–µ
- –ö–∞–∫ —ç—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –∫–æ–¥
- –ö–∞–∫ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä Go –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç "–∂–∏–∑–Ω—å" –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ö–∞–∫ –∏–∑–º–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

## üß™ Benchmark —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

```bash
go test -bench=. -benchmem -benchtime=100000000x
```

![alt text](https://github.com/orayew2002/stack_or_heap/blob/main/assets/result.png)


## üí° –ü–æ—á–µ–º—É escape –∑–∞–º–µ–¥–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É?
–ö–æ–≥–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **"—É—Ö–æ–¥–∏—Ç" –≤ –∫—É—á—É (heap)**, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

1. üì¶ **–ê–ª–ª–æ–∫–∞—Ü–∏—è –≤ –∫—É—á–µ (heap allocation)**  
   Go –≤—ã–∑—ã–≤–∞–µ—Ç –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –≤ –∫—É—á–µ.  
   - –≠—Ç–æ **–º–µ–¥–ª–µ–Ω–Ω–µ–µ**, —á–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ —Å—Ç–µ–∫–µ.  
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ Go, –Ω–∞–ø—Ä–∏–º–µ—Ä `runtime.newobject`.

2. üßπ **–†–∞–±–æ—Ç–∞ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ (GC)**  
   –í—Å—ë, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫—É—á–µ, –¥–æ–ª–∂–Ω–æ **–æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞**.  
   - GC –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –∫—É—á–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –±–æ–ª—å—à–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã.  
   - –≠—Ç–æ —Ç—Ä–∞—Ç–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –∏ —É—Ö—É–¥—à–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–µ–∫.

3. üìà **–ö—ç—à-–ø–∞–º—è—Ç—å CPU —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö—É–∂–µ**  
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å—Ç–µ–∫–µ –æ–±—ã—á–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç CPU –∫—ç—à—É (L1, L2) —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∫—É—á–µ –º–æ–≥—É—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø–∞–º—è—Ç–∏, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

‚ö†Ô∏è **Disclaimer**

–≠—Ç–æ —Ç–æ–ª—å–∫–æ –º–æ–∏ —Ç–µ—Å—Ç—ã –∏ —Å–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã Go escape analysis.  
–ù–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
